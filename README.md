# hdd_visualizer

## v4.3


## v4.2 - 修正坏道范围显示中 跨柱面的情况绘图精度与布局响应

**关键词：** `跨柱面修复` `响应式网格` `追加导入` `UI微调`

本次更新重点修复了少磁头硬盘（如 2 Heads）在跨柱面绘图时的丢步问题，并引入了更灵活的网格布局和数据合并功能。

- **🐛 绘图修复**
    - **跨柱面逻辑重构**：修复了 `Individual Surfaces` 模式下，当坏道范围跨越柱面（Cross-Cylinder）时，因 Python `range()` 差一错误（Off-by-one Error）导致的终点磁头漏画问题。
    - **边界对齐**：现在无论是标准 8 磁头还是 2 磁头模型，跨越 Head 0 的弧线均能精确闭合。
        
- **📐 布局与交互优化**    
    - **自适应网格系统**：分层视图（Individual Surfaces）不再强制 4 列显示。        
        - **动态滑块**：新增“每行图表数”滑块，仅在分层模式下出现。            
        - **智能极值**：滑块的最大值与默认值会自动根据当前硬盘的磁头数（Heads）进行钳位（例如 2 磁头硬盘最大只显示 2 列），避免无效留白。
    - **CSS 样式增强**：透明顶栏、边距修正
            
- **💾 数据管理**    
    - **CSV 追加导入**：导入对话框新增“**➕ 追加到末尾**”按钮。现在可以将多个 CSV 文件（如不同时间段的扫描日志）合并到同一个视图中进行分析，而不仅仅是覆盖。
    - yaml 改名


## v4.1 - 数学修正与体验优化

**关键词：** `数学修正` `多选过滤` `图例重构` `等级标准化`

底层坐标转换算法的精确性修复，并引入了更直观的交互式筛选功能。

- **物理算法修正**
    
    - **坐标转换精度**：修复了 `lba_to_chs` 计算中因缺少整型截断 (`int`) 导致的浮点漂移问题，现在扇区坐标能精确落入正确的柱面和角度。
    - **方程系数校正**：修正了 ZBR 柱面计算二次方程判别式中的系数错误（补全了缺失的系数 `2`），解决了 LBA 随容量增大产生的非线性定位偏差。
    - **末端物理特性**：确认并保留了 ZBR 模型中“非满载柱面”的数学特性，即最后一个物理柱面可能仅填充部分磁头。
        
- **交互与视图**    
    - **等级多选过滤器**：新增 `st.multiselect` 过滤器组件。用户现在可以动态勾选/取消特定的延迟等级（如仅查看 Critical 和 Error），图表将实时响应，便于在大数据量下聚焦关键问题。        
    - **可视化图例**：重构了图例区。        
    - **简化等级定义**：内部数据结构由 `level1`... 重构为简短的 `L1`, `L2`, `L3`, `L4`, `ERR`, `BAD`。
        

## v4.0 - 交互与可视化

**关键词：** `可视化增强` `配置管理` `辅助线逻辑` `数据导出`

修复视觉误差，并完善配置系统。

- **🎨 视觉与绘图增强**
    
    - **容量基准辅助线**：重绘了盘面辅助线。现在的同心圆基于 **容量百分比 (25%, 50%, 75%)** 的物理积分位置绘制，而非简单的半径等分，更符合 ZBR 密度特性。
        
    - **去缝隙处理**：使用 `ax.set_ylim(0, 1.0)` 彻底消除了外圈黑线与绘图区域之间的白色缝隙。
        
    - **中心留白**：辅助线仅在有效盘面区域（Ring）内绘制，主轴中心保持洁净。
        
    - **视图保持**：切换“合并视图 (Merge)”或“分层视图 (Individual)”后，刷新数据不再重置视图选项。
        
    - **独立放大**：分层模式下，每个磁头的图表现在是独立的容器，支持单独全屏查看细节。
        
- **⚙️ 配置与交互系统**
    
    - **UI内编辑配置**：侧边栏新增“解锁”功能，支持在 UI 中直接修改硬盘物理参数（LBA, RPM, Speed）并重命名型号，修改结果自动回写至 `presets.yaml`。
        
    - **智能 BlockSize**：下拉选框现在会自动记忆上次的选择；合并了 `1/64/128/256` 低容量块选项。
        
    - **CSV 导出**：新增导出功能，可将解析后的 LBA 范围与 Victoria 等级保存为 CSV 文件。
        

---

## ## v3.0 - CHS 模型与 Victoria 集成

**关键词：** `CHS架构` `多盘面` `Victoria日志` `延迟分级`

将内核从“单盘面模型”升级为“多盘面柱面模型”

- **🔧 核心物理架构升级**
    
    - **CHS 逆向计算**：引入 **LBA → Cylinder (柱面) → Head (磁头) → Sector (扇区)** 的完整转换逻辑。
        
    - **多磁头支持**：现在可以正确模拟多盘面硬盘（如 8 磁头），并支持将坏道映射到具体的物理磁头上。
        
    - **合并/分层视图**：支持将所有磁头数据叠加显示（用于判断垂直划伤），或分层独立显示。
        
- **📊 Victoria 深度集成**
    
    - **日志解析助手**：新增弹出式对话框，支持粘贴 Victoria 扫描日志（`Block start at...`），自动提取 LBA。
        
    - **动态阈值判定**：根据选定的 **BlockSize**（如 256, 2048, 16384等），自动应用对应的毫秒数阈值（`DELAY_THRESHOLDS`），精准判定颜色等级（Level 1~4 及 Error）。
        
    - **颜色分级系统**：弃用简单的秒数颜色，转为 Level 1 (灰) / Level 2 (绿) / Level 3 (橙) / Level 4 (红) / Error (蓝/紫)。
        
- **📄 配置文件**
    
    - 引入 `yaml` 外部文件管理硬盘预设参数，实现配置持久化。
        

---

## ## v2.0 - 物理修正：采样控制与精准角度

**关键词：** `角度修正` `显示逻辑` `Bug修复`

修正了早期版本中“螺旋线”导致的物理误导，并解决了大量数据点的性能问题。

- **📐 物理逻辑修正**
    
    - **移除螺旋模拟**：废弃了 `visual_windings` 参数。现在的角度 $\theta$ 严格由 `LBA % Current_SPT` 计算得出。
        
    - **圆弧表现**：连续的坏道现在会正确地画成一段顺沿磁道的**圆弧**，而非发散的螺旋线。
        
- **⚡ 采样与性能优化**
    
    - **智能显示逻辑**：
        
        - **单点**：Range 为单个扇区时，画点。
            
        - **圆弧**：Range 小于一圈时，仅画首尾及少量采样点形成弧线。
            
        - **全圆**：Range 超过物理磁道容量时，自动识别为 `Bad Track`，直接绘制完整圆环，不再生成数百万个采样点（修复了采样列表过长的 Bug）。
            
    - **列表优化**：UI 右侧列表仅显示录入条目摘要，不再列出所有绘图点。
        

---

## ## v1.0 - 基础构建：ZBR 物理反推与 CSV 同步

**关键词：** `ZBR算法` `速度映射` `CSV持久化` `界面重构`

基于速度反推半径

- **🧮 ZBR (Zone Bit Recording) 核心**
    
    - 实现了基于 **外圈速度/内圈速度 + 总 LBA** 反推物理半径的积分算法。
        
    - 摒弃了纯几何面积映射，利用 $r \propto v$ 物理特性，大幅提高了半径定位的准确性。
        
    - 支持反推物理总磁道数（Total Tracks）。
        
- **💾 数据与界面**
    
    - **CSV 同步**：实现了 `bad_sectors.csv` 的自动读取与保存，支持手动编辑或 UI 更新。
        
    - **双栏布局**：确立了左侧编辑器（Editor）、右侧可视化（Visualizer）的 UI 布局。
        
    - **基础颜色映射**：初步实现了基于响应时间（250ms/1s/3s/err）的颜色区分。